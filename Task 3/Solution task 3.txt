1. What are the names of the customers who have a balance that is greater than $9000 and are in the “HOUSEHOLD” market segment?

-- SELECT C_NAME FROM CUSTOMER WHERE C_ACCTBL > 9000 AND C_MKTSEGMENT='HOUSEHOLD';



2. Which parts are supplied by at least 1 supplier from the region “MIDDLE EAST”? Include the part name in your answer along with the part key. Eliminate any duplicates and sort your answer based on the part key.

-- SELECT P.P_NAME FROM PART P JOIN PARTSUPP PS ON P.P_PARTKEY=PS.PS_PARKEY JOIN SUPPLIER S ON S.S_SUPPKEY=PS.PS_SUPPKEY JOIN NATION N ON N.N_NATIONKEY=S.S_NATOINKEY JOIN REGION R ON R.R_REGIONKEY=N.N_REGIONKEY WHERE R.R_NAME='MIDDLE EAST' ORDER BY P.P_PARTKEY;



3. How many distinct parts are supplied by European suppliers?

-- SELECT COUNT(DISTINCT P.P_NAME) FROM PART AS P JOIN PARTSUPP PS ON P.P_PARTKEY=PS.PS_PARKEY JOIN SUPPLIER S ON S.S_SUPPKEY=PS.PS_SUPPKEY JOIN NATION N ON N.N_NATIONKEY=S.S_NATOINKEY JOIN REGION R ON R.R_REGIONKEY=N.N_REGIONKEY WHERE R.R_NAME='European';



4. Which parts are not supplied by any supplier from EUROPE? Include the part name in your answer.

-- SELECT P.P_NAME FROM PART AS P JOIN PARTSUPP AS PS ON P.P_PARTKEY=PS.PS_PARKEY JOIN SUPPLIER AS S ON PS.PS_SUPPKEY=S.S_SUPPKEY JOIN NATION N ON S.S_NATIONKEY = N.N_NATION_KEY JOIN REGION R ON N.N_REGIONKEY=R.R_REGIONKEY WHERE R.R_NAME <> 'EUROPE';



5. Which customers ordered parts ONLY from suppliers in the same region? Include the customer name, phone and region in your answer, and remove any duplicates.

-- SELECT DISTINCT C.C_NAME , C.C_PHONE , N.N_NAME FROM CUSTOMER AS C JOIN ORDERS AS O ON C.C_CUSTKEY = O.O_CUSTKEY JOIN LINEITEMS AS L ON O.O_ORDERKEY = L.L_ORDERKEY AND O.O_PARTKEY = L.L_PARTKEY JOIN PARTSUP AS PS ON L.L_SUPPKEY = PS.PS_SUPPKEY JOIN SUPPLIER AS S ON PS.PS_SUPPKEY = S.S_SUPPKEY JOIN NATION AS N ON S.S_NATIONKEY = N.N_NATIONKEY WHERE C.C_CUSTKEY NOT IN ( SELECT DISTINCT C2.C_CUSTKEY FROM ORDERS O2 JOIN CUSTOMER AS C2 ON O2.O_CUSTKEY = C2.C_CUSTKEY JOIN LINEITEM AS L2 ON O2.O_ORDERKEY = L2.L_ORDERKEY JOIN PARTSUPP AS PS2 ON L2.L_PARTKEY = PS2.PS_PARTKEY AND L2.L_SUPPKEY = PS2.PS_SUPPKEY JOIN SUPPLIER S2 AS PS2.PS_SUPPKEY = S2.S_SUPPKEY JOIN NATION N2 ON S2.S_NATIONKEY = N2.N_NATIONKEY WHERE N2.N_REGIONKEY <> N.N_REGIONKEY );




6. What is the highest extended price for parts that had a discount larger than the tax when ordered?

-- SELECT MAX(L.L_EXTENDEDPRICE) FROM LINEITEMS AS L JOIN ORDERS AS O ON L.L_ORDERKEY = O.O_ORDERKEY WHERE L.L_DISCOUNT > L.L_TAX;



7. The number of orders that had all of their items received in at most 2 weeks of shipment. HINT 1 : avoid counting duplicates . HINT 2 : In SQL Server, you can compute the date difference with the DATEDIFF() function . It takes 3 parameters: unit , start date, end date. For example,
SELECT DATEDIFF(day, '2013-09-16', '2013-09-23')
returns 7as the answer.
You can put fields in the 2nd and 3rd argument.

-- SELECT COUNT(DISTINCT O.O_ORDERKEY) FROM ORDERS AS O JOIN LINEITEM AS L ON O.O_ORDERKEY = L.L_ORDERKEY WHERE DATEDIFF(WEEK , L.L_SHIPDATE , L.L_RECEIPTDATE) < 2; 




8. The number of (distinct) customers who did not order any part that has some American supplier.

-- SELECT COUNT(DISTINCT O.O_CUSTKEY) FROM ORDERS AS O WHERE O.O_CUSTKEY NOT IN ( SELECT DISTINCT C2.C_CUSTKEY FROM ORDERS O2 JOIN CUSTOMER AS C2 ON O2.O_CUSTKEY = C2.C_CUSTKEY JOIN LINEITEM AS L2 ON O2.O_ORDERKEY = L2.L_ORDERKEY JOIN PARTSUPP AS PS2 ON L2.L_PARTKEY = PS2.PS_PARTKEY AND L2.L_SUPPKEY = PS2.PS_SUPPKEY JOIN SUPPLIER S2 AS PS2.PS_SUPPKEY = S2.S_SUPPKEY JOIN NATION N2 ON S2.S_NATIONKEY = N2.N_NATIONKEY WHERE N2.N_NAME = 'AMERICAN' );



9. Which nation does the customer with the highest balance come from?
HINT: you can find the maximum value with a simple nested select query. 

-- SELECT N.N_NAME FROM CUSTOMER AS C JOIN NATION AS N ON C.C_NATIONKEY = N.N_NATIONKEY ORDER BY C.C_ACCTBL DESC; SELECT N.N_NAME FROM NATION AS N JOIN CUSTOMER AS C ON N.N_NATIONKEY = C.C_NATIONKEY WHERE C.C_ACCTBAL = ( SELECT MAX(C_ACCTBAL) FROM CUSTOMER );




10. List the names of the countries where some parts took more than 29 days to ship, despite being supplied from a supplier to a customer in this same country.

-- SELECT DISTINCT N.N_NAME FROM PARTSUP AS PS JOIN LINEITEM AS L ON PS.PS_PARTKEY = L.L_PARTKEY AND PS.PS_SUPPKEY = L.L_SUPPKEY JOIN ORDERS AS O ON L.L_ORDERKEY = O.O_ORDERKEY JOIN CUSTOMER AS C ON O.O_CUSTKEY = C.C_CUSTKEY JOIN NATION AS N ON C.C_NATIONKEY = N.N_NATIONKEY JOIN SUPPLIER AS S ON PS.PS_SUPPKEY = S.S_SUPPKEY WHERE DATEDIFF(DAY , L.L_SHIPDATE , L.L_RECEIPTDATE) > 29 AND S.S_NATIONKEY = C.C_NATIONKEY AND S.S_NATIONKEY = N.N_NATIONKEY;




11. which artists did not make any albums at all? include their names in your answer. 

-- SELECT AR.NAME FROM ARTIST AS AR LEFT JOIN ALBUM AS AL ON AR.ARTISTID = AL.ARTISTID WHERE AL.ALBUMID IS NULL; 


12. which artists did not record any tracks of the latin genre?

-- SELECT DISTINCT AR.NAME FROM ARITIST AS AR LEFT JOIN ALBUM AS AL ON AR.ARTISTID = AL.ARTISTID LEFT JOIN TRACK AS TR ON AL.ALBUMID = TR.ALBUMID LEFT JOIN GENRE AS GE ON TR.GENREID = GE.GENREID WHERE GE.NAME <> 'LATIN' OR TR.GENREID IS NULL ; SELECT DISTINCT AR.NAME FROM ARITIST AS AR LEFT JOIN ALBUM AS AL ON AR.ARTISTID = AL.ARTISTID LEFT JOIN TRACK AS TR ON AL.ALBUMID = TR.ALBUMID LEFT JOIN GENRE AS GE ON TR.GENREID = GE.GENREID WHERE GE.NAME <> 'LATIN' OR GE.GENREID IS NULL ;


13. which video track has the longest length? 

-- SELECT TR.NAME , MT.NAME FROM TRACK AS TR JOIN MEDIATYPE AS MT ON TR.MEDIATYPEID = MT.MEDIATYPEID WHERE MT.NAME LIKE '%VIDEO%' ORDER BY TR.MILLISECONDS DESC LIMIT 1; 


14. find the names of customers who live in the same city as the top employee (the one not managed by anyone) 

-- SELECT C.FIRSTNAME , C.LASTNAME FROM CUSTOMER AS C JOIN EMPLOYEE AS E ON C.CUTOMERID = E.EMPLOYEEID WHERE C.CITY = E.CITY AND E.REPORTSTO IS NULL ; SELECT C.FIRSTNAME, C.LASTNAME FROM CUSTOMER AS C LEFT JOIN EMPLOYEE AS E ON C.CITY = E.CITY WHERE E.REPORTSTO IS NULL


15. find the managers of employees supporting brazilian customers 

-- SELECT * FROM EMPLOYEE AS E JOIN CUSTOMER AS C ON E.EMPLOYEEID = C.CUSTOMERID WHERE E.TITLE = 'MANAGER' AND C.CITY = 'BRAZIL'; SELECT DISTINCT E1.FIRSTNAME, E1.LASTNAME FROM EMPLOYEE E1 JOIN EMPLOYEE E2 ON E1.EMPLOYEEID = E2.REPORTSTO JOIN CUSTOMER C ON E2.EMPLOYEEID = C.SUPPORTREPID WHERE C.COUNTRY = 'BRAZIL'; 



16. how many audio tracks in total were bought by german customers ? and what was the total price paid for them? 

-- SELECT SUM(IL.QUANTITY) AS TOTALQUANTITY , SUM(IL.QUANTITY * IL.UNITPRICE) AS TOTALPRICEPAID FROM TRACK AS TR JOIN MEDIATYPE AS MT ON TR.MEDIATYPEID = MT.MEDIATYPEID JOIN INVOICELINE AS IL ON MT.TRACKID = IL.TRACKID JOIN INVOICE AS I ON IL.INVOICEID = I.INVOICEID JOIN CUSTOMER AS C ON I.CUSTOMERID = C.CUSTOMERID WHERE MT.NAME LIKE '%AUDIO%' AND C.CITY = 'GERMAN'; 



17. what is the space, in bytes, occupied by the playlist “grunge” , and how much would it cost? 

-- SELECT SUM(T.BYTES) AS SPACEOCCUPIED , SUM(UNITPRICE) AS TOTALPRICE FROM PLAYLIST AS P JOIN PLAYLISTTRACK AS PT ON P.PLAYLISTID = PT.PLAYLISTID JOIN TRACK AS T ON PT.TRACKID = T.TRACKID WHERE P.NAME = 'GRUNGE';









